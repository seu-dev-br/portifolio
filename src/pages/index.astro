---
import Layout from '../layouts/Layout.astro';
import { getAllPublishedPosts, getAllPublishedProjects, getHomeData } from '../lib/supabase';
import PageLoading from '../components/PageLoading.astro';
import OptimizedImage from '../components/OptimizedImage.astro';

// Fetch home configuration and latest posts/projects
const homeData = await getHomeData();
const posts = await getAllPublishedPosts();
const latestPosts = posts.slice(0, homeData?.posts?.count || 3);

const projects = await getAllPublishedProjects();
const featuredProjects = projects.slice(0, homeData?.featured?.count || 3);
---

<Layout title="Ítalo Antonio - Desenvolvedor Full Stack">
	<!-- Page Loading -->
	<PageLoading />
	<!-- Hero Section / Slider -->
	<section class="relative min-h-[80vh] flex items-center justify-center bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 overflow-hidden">
		<!-- Background Pattern -->
		<div class="absolute inset-0 opacity-10">
			<div class="absolute top-20 left-20 w-72 h-72 bg-primary-500 rounded-full mix-blend-multiply filter blur-xl animate-bounce-subtle"></div>
			<div class="absolute top-40 right-20 w-72 h-72 bg-accent-cyan rounded-full mix-blend-multiply filter blur-xl animate-bounce-subtle delay-100"></div>
			<div class="absolute bottom-20 left-1/3 w-72 h-72 bg-accent-blue rounded-full mix-blend-multiply filter blur-xl animate-bounce-subtle delay-200"></div>
		</div>

		{homeData?.slider?.enabled && homeData?.slider?.items && homeData.slider.items.length > 0 ? (
			<!-- Swiper Slider -->
			<div class="swiper hero-swiper">
				<div class="swiper-wrapper">
						{homeData?.slider?.items?.map((slide: import('../lib/types').SliderItem, index: number) => (
						<div class="swiper-slide">
							<!-- Background Image -->
							<div class="slide-bg" style={`background-image: url(${slide.image})`}></div>
							<!-- Overlay -->
							<div class="slide-overlay"></div>

							<!-- Content -->
							<div class="slide-content">
								<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center">
									<div class="text-center w-full animate-fade-in">
										<h1 class="text-5xl md:text-7xl font-bold mb-6">
											{slide.link ? (
												<a href={slide.link} class="hover:opacity-80 transition-opacity duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label={`Acessar: ${slide.title}`} tabindex="0" role="link">
													<span class="bg-gradient-to-r from-primary-400 via-accent-cyan to-accent-blue bg-clip-text text-transparent">
														{slide.title}
													</span>
												</a>
											) : (
												<span class="bg-gradient-to-r from-primary-400 via-accent-cyan to-accent-blue bg-clip-text text-transparent">
													{slide.title}
												</span>
											)}
										</h1>
										{slide.subtitle && (
											<h2 class="text-xl md:text-2xl text-gray-300 mb-8 font-light">
												{slide.subtitle}
											</h2>
										)}
										{slide.description && (
											<p class="text-lg md:text-xl text-gray-400 mb-12 max-w-3xl mx-auto leading-relaxed">
												{slide.description}
											</p>
										)}
									</div>
								</div>
							</div>
						</div>
					))}
				</div>

				<!-- Navigation -->
				{homeData?.slider?.items?.length > 1 && (
					<>
						<div class="swiper-button-next"></div>
						<div class="swiper-button-prev"></div>
						<div class="swiper-pagination"></div>
					</>
				)}
			</div>
		) : (
			<!-- Fallback: Simple Hero Section -->
			<div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
				<div class="animate-fade-in">
					<h1 class="text-5xl md:text-7xl font-bold mb-6">
						<span class="bg-gradient-to-r from-primary-400 via-accent-cyan to-accent-blue bg-clip-text text-transparent">
							Sem slides configurados
						</span>
					</h1>
					<h2 class="text-xl md:text-2xl text-gray-300 mb-8 font-light">
						Configure o slider no painel administrativo
					</h2>
					<p class="text-lg md:text-xl text-gray-400 mb-12 max-w-3xl mx-auto leading-relaxed">
						Acesse o admin para configurar os slides do slider da página inicial.
					</p>

					<div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
						<a href="/admin" class="bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-500 hover:to-primary-400 text-white px-8 py-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-xl shadow-primary-500/25 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Acessar painel administrativo" tabindex="0" role="button">
							Acessar Admin
						</a>
						<a href="/contato" class="border-2 border-gray-600 hover:border-primary-400 text-gray-300 hover:text-primary-400 px-8 py-4 rounded-lg font-semibold transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Entrar em contato" tabindex="0" role="button">
							Entrar em Contato
						</a>
					</div>
				</div>
			</div>
		)}

		<!-- Scroll Indicator -->
		<div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce z-10">
			<svg class="w-6 h-6 text-gray-400 hover:text-primary-400 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
			</svg>
		</div>
	</section>

	<!-- Latest Posts Section -->
	{latestPosts && latestPosts.length >= 0 && (
		<section class="py-20 bg-gray-900/50">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="text-center mb-16">
					<h2 class="text-3xl md:text-4xl font-bold mb-4 bg-gradient-to-r from-primary-400 to-accent-cyan bg-clip-text text-transparent">
						{homeData?.posts?.title || 'Últimas Publicações'}
					</h2>
					<p class="text-lg max-w-2xl mx-auto">
						{homeData?.posts?.description || 'Compartilhando conhecimento e experiências sobre desenvolvimento'}
					</p>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
					{latestPosts.map((post) => (
						<article class="bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-gray-700/50 hover:border-primary-500/50 transition-all duration-300 group hover:transform hover:scale-105 hover:shadow-2xl hover:shadow-primary-500/10">
							{post.coverImage && (
								<div class="overflow-hidden">
									   <OptimizedImage src={post.coverImage} alt={post.title} width={800} height={400} class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500" />
								</div>
							)}
							<div class="p-6">
								<h3 class="text-xl font-semibold text-white mb-3 group-hover:text-primary-400 transition-colors duration-200 line-clamp-2">
									<a href={`/blog/${post.slug}`} aria-label={`Ler post: ${post.title}`} tabindex="0" role="link">{post.title}</a>
								</h3>
								<p class="mb-4 line-clamp-3">
									{post.excerpt}
								</p>
								<div class="flex items-center justify-between">
									<div class="flex flex-wrap gap-2">
										{post.tags && post.tags.length > 0 && post.tags.slice(0, 2).map((tag: string) => (
											<span class="px-2 py-1 bg-gray-700/50 text-gray-300 text-xs rounded-full hover:bg-primary-500/20 hover:text-primary-300 transition-all duration-200">
												{tag}
											</span>
										))}
									</div>
									<a href={`/blog/${post.slug}`} class="text-primary-400 hover:text-primary-300 font-medium transition-colors duration-200 hover:translate-x-1 transform focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label={`Ler mais sobre: ${post.title}`} tabindex="0" role="link">
										Ler mais →
									</a>
								</div>
							</div>
						</article>
					))}
				</div>

				<div class="text-center mt-12">
					<a href="/blog" class="inline-flex items-center gap-2 bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 hover:text-primary-400 px-6 py-3 rounded-lg transition-all duration-200 border border-gray-700/50 hover:border-primary-500/50 hover:shadow-lg hover:shadow-primary-500/10 transform hover:scale-105 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Ver todas as publicações do blog" tabindex="0" role="button">
						Ver Todas as Publicações
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
				</div>
			</div>
		</section>
	)}

	<!-- Featured Projects Section -->
	{featuredProjects && featuredProjects.length >= 0 && (
		<section class="py-20 bg-gray-900/50">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="text-center mb-16">
					<h2 class="text-3xl md:text-4xl font-bold mb-4 bg-gradient-to-r from-primary-400 to-accent-cyan bg-clip-text text-transparent">
						{homeData?.featured?.title || 'Projetos em Destaque'}
					</h2>
					<p class="text-lg max-w-2xl mx-auto">
						{homeData?.featured?.description || 'Alguns dos meus trabalhos mais recentes e impactantes'}
					</p>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
					{featuredProjects.map((project) => (
						<article class="bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-gray-700/50 hover:border-primary-500/50 transition-all duration-300 group hover:transform hover:scale-105 hover:shadow-2xl hover:shadow-primary-500/10">
							{project.image && (
								<div class="overflow-hidden">
									   <OptimizedImage src={project.image} alt={project.title} width={800} height={400} class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500" />
								</div>
							)}
							<div class="p-6">
								<h3 class="text-xl font-semibold text-white mb-3 group-hover:text-primary-400 transition-colors duration-200 line-clamp-2">
									{project.title}
								</h3>
								<p class="mb-4 line-clamp-3">
									{project.description}
								</p>
								{project.technologies && project.technologies.length > 0 && (
									<div class="flex flex-wrap gap-2 mb-4">
										{project.technologies.slice(0, 3).map((tech: string) => (
											<span class="px-2 py-1 bg-gray-700/50 text-gray-300 text-xs rounded-full hover:bg-primary-500/20 hover:text-primary-300 transition-all duration-200">
												{tech}
											</span>
										))}
									</div>
								)}
								<div class="flex gap-3">
									{project.demoLink && (
										<a href={project.demoLink} class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-lg transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" target="_blank" rel="noopener noreferrer" aria-label={`Ver demo do projeto: ${project.title}`} tabindex="0" role="link">
											Demo
										</a>
									)}
									{project.githubLink && (
										<a href={project.githubLink} class="inline-flex items-center px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 text-sm font-medium rounded-lg transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-400" target="_blank" rel="noopener noreferrer" aria-label={`Ver código no GitHub: ${project.title}`} tabindex="0" role="link">
											GitHub
										</a>
									)}
								</div>
							</div>
						</article>
					))}
				</div>

				<div class="text-center mt-12">
					<a href="/projetos" class="inline-flex items-center px-6 py-3 bg-transparent border-2 border-primary-500 hover:bg-primary-500 text-primary-400 hover:text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Ver todos os projetos" tabindex="0" role="link">
						Ver Todos os Projetos
					</a>
				</div>
			</div>
		</section>
	)}

	<!-- Skills Section -->
	<section class="py-20 bg-gray-900/50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center mb-16">
				<h2 class="text-3xl md:text-4xl font-bold mb-4 bg-gradient-to-r from-primary-400 to-accent-cyan bg-clip-text text-transparent">
					Tecnologias que Uso
				</h2>
				<p class="text-lg max-w-2xl mx-auto">
					Ferramentas e tecnologias que utilizo para criar soluções incríveis
				</p>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				<div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-primary-500/50 transition-all duration-300">
					<h3 class="text-xl font-semibold text-white mb-4">
						Frontend
					</h3>
					<p class="text-gray-400">
						React, Vue.js, Astro, TypeScript, HTML5, CSS3
					</p>
				</div>
				<div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-primary-500/50 transition-all duration-300">
					<h3 class="text-xl font-semibold text-white mb-4">
						Backend
					</h3>
					<p class="text-gray-400">
						Node.js, Python, Supabase, PostgreSQL, MongoDB
					</p>
				</div>
				<div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-primary-500/50 transition-all duration-300">
					<h3 class="text-xl font-semibold text-white mb-4">
						DevOps
					</h3>
					<p class="text-gray-400">
						Docker, GitHub Actions, Vercel, AWS
					</p>
				</div>
			</div>
		</div>
	</section>

	<!-- CTA Section -->
	<section class="py-20 bg-gradient-to-r from-primary-900/20 to-accent-blue/20">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<h2 class="text-3xl md:text-4xl font-bold mb-6 bg-gradient-to-r from-primary-400 to-accent-cyan bg-clip-text text-transparent">
				Vamos Trabalhar Juntos?
			</h2>
			<p class="text-gray-400 text-lg mb-8 max-w-2xl mx-auto">
				Estou sempre interessado em novos projetos e oportunidades.
				Vamos conversar sobre como posso ajudar a transformar suas ideias em realidade.
			</p>
			<div class="flex flex-col sm:flex-row gap-4 justify-center">
				<a href="/contato" class="bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-500 hover:to-primary-400 text-white px-8 py-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-xl hover:shadow-primary-500/25 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Entrar em contato" tabindex="0" role="button">
					Entrar em Contato
				</a>
				<a href="/sobre" class="border-2 border-gray-600 hover:border-primary-400 text-gray-300 hover:text-primary-400 px-8 py-4 rounded-lg font-semibold transition-all duration-300 hover:shadow-lg hover:shadow-primary-400/25 transform hover:scale-105 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400" aria-label="Sobre mim" tabindex="0" role="button">
					Sobre Mim
				</a>
			</div>
		</div>
	</section>
</Layout>

<script>
	import Swiper from 'swiper';
	import { Navigation, Pagination, Autoplay, Keyboard, EffectFade } from 'swiper/modules';
	import 'swiper/css';
	import 'swiper/css/navigation';
	import 'swiper/css/pagination';
	import 'swiper/css/effect-fade';

	document.addEventListener('DOMContentLoaded', function() {
		// Swiper initialization
		const heroSwiper = document.querySelector('.hero-swiper');

		if (heroSwiper) {
			const swiper = new Swiper('.hero-swiper', {
				modules: [Navigation, Pagination, Autoplay, Keyboard, EffectFade],
				slidesPerView: 1,
				spaceBetween: 0,
				loop: true,
				effect: 'fade',
				fadeEffect: { crossFade: true },
				navigation: {
					nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev',
				},
				pagination: {
					el: '.swiper-pagination',
					clickable: true,
					dynamicBullets: true,
				},
				autoplay: {
					delay: 5000,
					disableOnInteraction: false,
					pauseOnMouseEnter: true,
				},
				keyboard: {
					enabled: true,
					onlyInViewport: true,
				},
				a11y: {
					prevSlideMessage: 'Slide anterior',
					nextSlideMessage: 'Próximo slide',
					firstSlideMessage: 'Este é o primeiro slide',
					lastSlideMessage: 'Este é o último slide',
					paginationBulletMessage: 'Ir para slide {{index}}',
				},
				breakpoints: {
					320: { slidesPerView: 1 },
					640: { slidesPerView: 1 },
					1024: { slidesPerView: 1 },
				},
				on: {
					init: function() {
						console.log('🎠 Swiper inicializado com sucesso!');
					},
					slideChange: function() {
						console.log('🎠 Slide mudou para:', );
					}
				}
			});

			// Pause autoplay on hover
			heroSwiper.addEventListener('mouseenter', () => swiper.autoplay.stop());
			heroSwiper.addEventListener('mouseleave', () => swiper.autoplay.start());
		}

		// Intersection Observer for animations
		const observerOptions = {
			threshold: 0.1,
			rootMargin: '0px 0px -50px 0px'
		};

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					entry.target.classList.add('animate-in');
				}
			});
		}, observerOptions);

		// Observe elements for animation
		document.querySelectorAll('.animate-on-scroll').forEach(el => {
			observer.observe(el);
		});

		// Smooth scroll for anchor links
		document.querySelectorAll('a[href^="#"]').forEach(anchor => {
			anchor.addEventListener('click', function (e: Event) {
				e.preventDefault();
				const target = document.querySelector((e.target as HTMLAnchorElement).getAttribute('href')!);
				if (target) {
					target.scrollIntoView({
						behavior: 'smooth',
						block: 'start'
					});
				}
			});
		});

		// Add loading states for images
		document.querySelectorAll('img').forEach(img => {
			if (!img.complete) {
				img.style.opacity = '0';
				img.addEventListener('load', () => {
					img.style.transition = 'opacity 0.3s ease';
					img.style.opacity = '1';
				});
			}
		});
	});
</script>

<script>
	import Swiper from 'swiper';
	import { Navigation, Pagination, Autoplay, Keyboard, EffectFade } from 'swiper/modules';
	import 'swiper/css';
	import 'swiper/css/navigation';
	import 'swiper/css/pagination';
	import 'swiper/css/effect-fade';

	document.addEventListener('DOMContentLoaded', function() {
		const heroSwiper = document.querySelector('.hero-swiper');

		if (heroSwiper) {
			const swiper = new Swiper('.hero-swiper', {
				modules: [Navigation, Pagination, Autoplay, Keyboard, EffectFade],

				// Configurações básicas
				slidesPerView: 1,
				spaceBetween: 0,
				loop: true,

				// Efeitos
				effect: 'fade',
				fadeEffect: {
					crossFade: true
				},

				// Navegação
				navigation: {
					nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev',
				},

				// Paginação
				pagination: {
					el: '.swiper-pagination',
					clickable: true,
					dynamicBullets: true,
				},

				// Autoplay
				autoplay: {
					delay: 5000,
					disableOnInteraction: false,
					pauseOnMouseEnter: true,
				},

				// Keyboard navigation
				keyboard: {
					enabled: true,
					onlyInViewport: true,
				},

				// Acessibilidade
				a11y: {
					prevSlideMessage: 'Slide anterior',
					nextSlideMessage: 'Próximo slide',
					firstSlideMessage: 'Este é o primeiro slide',
					lastSlideMessage: 'Este é o último slide',
					paginationBulletMessage: 'Ir para slide {{index}}',
				},

				// Configurações responsivas
				breakpoints: {
					320: {
						slidesPerView: 1,
					},
					640: {
						slidesPerView: 1,
					},
					1024: {
						slidesPerView: 1,
					},
				},

				// Callbacks
				on: {
					init: function() {
						console.log('🎠 Swiper inicializado com sucesso!');
					},
					slideChange: function() {
						console.log('🎠 Slide mudou para:', );
					}
				}
			});

			// Pausar autoplay no hover
			heroSwiper.addEventListener('mouseenter', function() {
				swiper.autoplay.stop();
			});

			heroSwiper.addEventListener('mouseleave', function() {
				swiper.autoplay.start();
			});
		}
	});

	// Scroll Animations
	document.addEventListener('DOMContentLoaded', function() {
		const observerOptions = {
			threshold: 0.1,
			rootMargin: '0px 0px -50px 0px'
		};

		const observer = new IntersectionObserver(function(entries) {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					entry.target.classList.add('animate-in');
				}
			});
		}, observerOptions);

		// Observe all elements with animate-on-scroll class
		document.querySelectorAll('.animate-on-scroll').forEach(el => {
			observer.observe(el);
		});
	});
</script>


