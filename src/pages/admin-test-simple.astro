---
import '../styles/tailwind.css';
import '../styles/animations.css';
import '../styles/theme.css';
---

<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Test - Portf√≥lio</title>
</head>
<body class="min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-4">
  <div class="w-full max-w-md bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
    <h1 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center">Teste Simples de Login</h1>

    <div id="loading" class="hidden text-center text-gray-500 dark:text-gray-300 mb-4">Carregando...</div>

    <form id="login-form" class="space-y-5">
      <div>
        <label for="email" class="block mb-1 font-semibold text-gray-700 dark:text-gray-200">Email:</label>
        <input type="email" id="email" value="admin@italo.dev" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 transition" />
      </div>
      <div>
        <label for="password" class="block mb-1 font-semibold text-gray-700 dark:text-gray-200">Senha:</label>
        <input type="password" id="password" value="Italo2025Admin!" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 transition" />
      </div>
      <button type="submit" class="w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-400">Fazer Login</button>
    </form>

    <div id="message" class="mt-4"></div>
  </div>

    <!-- Supabase Client -->
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        const supabaseUrl = 'https://nattvkjaecceirxthizc.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hdHR2a2phZWNjZWlyeHRoaXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MjM2NTMsImV4cCI6MjA3MjQ5OTY1M30.K6Nfu5oGeoo6bZyToBNWkBdA1CncXEjWIrSydlMU2WQ';

        console.log('üîß Inicializando Supabase...');

        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        window.supabase = supabase;
        window.supabaseInitialized = true;

        console.log('‚úÖ Supabase inicializado');
    </script>

    <!-- Login Script -->
    <script>
        console.log('üöÄ Inicializando script de login...');

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado');

            const loginForm = document.getElementById('login-form') as HTMLFormElement;
            const loading = document.getElementById('loading') as HTMLElement;
            const message = document.getElementById('message') as HTMLElement;

            if (!loginForm || !loading || !message) {
                console.error('‚ùå Elementos n√£o encontrados');
                return;
            }

            console.log('‚úÖ Formul√°rio encontrado');

            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('üìù Formul√°rio submetido');

                // Mostrar loading
                loading.style.display = 'block';
                message.innerHTML = '';

                try {
                    const email = (document.getElementById('email') as HTMLInputElement).value;
                    const password = (document.getElementById('password') as HTMLInputElement).value;

                    console.log('üîê Tentando login...', { email });

                    if (!window.supabase) {
                        throw new Error('Supabase n√£o inicializado');
                    }

                    const { data, error } = await window.supabase.auth.signInWithPassword({
                        email,
                        password
                    });

                    console.log('üìä Resposta:', { data: !!data, error });

                    if (error) {
                        throw error;
                    }

                    if (data.user) {
                        console.log('‚úÖ Login bem-sucedido!');
                        message.innerHTML = '<div class="message success">Login realizado com sucesso! Usu√°rio: ' + data.user.email + '</div>';

                        // Logout autom√°tico ap√≥s 3 segundos
                        setTimeout(async () => {
                            await window.supabase.auth.signOut();
                            console.log('üëã Logout autom√°tico realizado');
                            message.innerHTML += '<div class="message success">Logout autom√°tico realizado</div>';
                        }, 3000);
                    } else {
                        throw new Error('Login falhou - nenhum usu√°rio retornado');
                    }

                } catch (error: any) {
                    console.error('‚ùå Erro:', error);
                    message.innerHTML = '<div class="message error">Erro: ' + (error.message || 'Erro desconhecido') + '</div>';
                } finally {
                    // Esconder loading
                    loading.style.display = 'none';
                    console.log('üîÑ Loading escondido');
                }
            });
        });
    </script>
</body>
</html>
