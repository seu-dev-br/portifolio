---
---

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Test - Portf√≥lio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .loading {
            display: none;
            text-align: center;
            color: #666;
        }
        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste Simples de Login</h1>

        <div id="loading" class="loading">
            Carregando...
        </div>

        <form id="login-form">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" value="admin@italo.dev" required>
            </div>

            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" value="Italo2025Admin!" required>
            </div>

            <button type="submit">Fazer Login</button>
        </form>

        <div id="message"></div>
    </div>

    <!-- Supabase Client -->
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        const supabaseUrl = 'https://nattvkjaecceirxthizc.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hdHR2a2phZWNjZWlyeHRoaXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MjM2NTMsImV4cCI6MjA3MjQ5OTY1M30.K6Nfu5oGeoo6bZyToBNWkBdA1CncXEjWIrSydlMU2WQ';

        console.log('üîß Inicializando Supabase...');

        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        window.supabase = supabase;
        window.supabaseInitialized = true;

        console.log('‚úÖ Supabase inicializado');
    </script>

    <!-- Login Script -->
    <script>
        console.log('üöÄ Inicializando script de login...');

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado');

            const loginForm = document.getElementById('login-form') as HTMLFormElement;
            const loading = document.getElementById('loading') as HTMLElement;
            const message = document.getElementById('message') as HTMLElement;

            if (!loginForm || !loading || !message) {
                console.error('‚ùå Elementos n√£o encontrados');
                return;
            }

            console.log('‚úÖ Formul√°rio encontrado');

            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('üìù Formul√°rio submetido');

                // Mostrar loading
                loading.style.display = 'block';
                message.innerHTML = '';

                try {
                    const email = (document.getElementById('email') as HTMLInputElement).value;
                    const password = (document.getElementById('password') as HTMLInputElement).value;

                    console.log('üîê Tentando login...', { email });

                    if (!window.supabase) {
                        throw new Error('Supabase n√£o inicializado');
                    }

                    const { data, error } = await window.supabase.auth.signInWithPassword({
                        email,
                        password
                    });

                    console.log('üìä Resposta:', { data: !!data, error });

                    if (error) {
                        throw error;
                    }

                    if (data.user) {
                        console.log('‚úÖ Login bem-sucedido!');
                        message.innerHTML = '<div class="message success">Login realizado com sucesso! Usu√°rio: ' + data.user.email + '</div>';

                        // Logout autom√°tico ap√≥s 3 segundos
                        setTimeout(async () => {
                            await window.supabase.auth.signOut();
                            console.log('üëã Logout autom√°tico realizado');
                            message.innerHTML += '<div class="message success">Logout autom√°tico realizado</div>';
                        }, 3000);
                    } else {
                        throw new Error('Login falhou - nenhum usu√°rio retornado');
                    }

                } catch (error: any) {
                    console.error('‚ùå Erro:', error);
                    message.innerHTML = '<div class="message error">Erro: ' + (error.message || 'Erro desconhecido') + '</div>';
                } finally {
                    // Esconder loading
                    loading.style.display = 'none';
                    console.log('üîÑ Loading escondido');
                }
            });
        });
    </script>
</body>
</html>
